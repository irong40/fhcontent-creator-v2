---
phase: 01-infrastructure-foundation
plan: "04"
type: execute
wave: 3
depends_on:
  - "01-01"
  - "01-02"
  - "01-03"
files_modified:
  - D:/Projects/fhcontent-creator-v2/n8n-workflows/canary-timezone-test.json
autonomous: false
requirements:
  - INFRA-05
  - INFRA-06
user_setup:
  - service: claude-anthropic
    why: "Claude API key required for n8n credential store population"
    env_vars:
      - name: ANTHROPIC_API_KEY
        source: "console.anthropic.com → API Keys"
  - service: heygen
    why: "HeyGen API key for video generation workflows"
    env_vars:
      - name: HEYGEN_API_KEY
        source: "app.heygen.com → Settings → API → API Token"
  - service: blotato
    why: "Blotato API key for short-form video and social publishing"
    env_vars:
      - name: BLOTATO_API_KEY
        source: "Blotato dashboard → Settings → API Keys"
  - service: elevenlabs
    why: "ElevenLabs API key for TTS and podcast generation"
    env_vars:
      - name: ELEVENLABS_API_KEY
        source: "elevenlabs.io → Profile → API Keys"
  - service: gemini-google
    why: "Gemini API key for image generation"
    env_vars:
      - name: GEMINI_API_KEY
        source: "aistudio.google.com → Get API key"
  - service: openai
    why: "OpenAI API key (reserved for future use)"
    env_vars:
      - name: OPENAI_API_KEY
        source: "platform.openai.com → API Keys"
  - service: canva
    why: "Canva API key for design generation"
    env_vars:
      - name: CANVA_API_KEY
        source: "canva.com → Developer Portal → Your integrations → API key"
  - service: supabase
    why: "Supabase service role key for admin DB writes; anon key for RLS-protected reads"
    env_vars:
      - name: SUPABASE_SERVICE_ROLE_KEY
        source: "supabase.com → Project qjpujskwqaehxnqypxzu → Settings → API → service_role key"
      - name: SUPABASE_ANON_KEY
        source: "supabase.com → Project qjpujskwqaehxnqypxzu → Settings → API → anon key"

must_haves:
  truths:
    - "All 9 API credentials appear in n8n Settings → Credentials by their exact names listed below"
    - "Each credential passes the n8n built-in connection test (green checkmark)"
    - "A test workflow with a 1-minute Schedule Trigger fires and writes a timestamp to Supabase"
    - "The written timestamp matches the wall clock Eastern Time (America/New_York)"
    - "The canary workflow JSON is exported and committed to n8n-workflows/"
  artifacts:
    - path: "D:/Projects/fhcontent-creator-v2/n8n-workflows/canary-timezone-test.json"
      provides: "Exported n8n workflow JSON for canary Schedule Trigger + Supabase write"
      contains: "Schedule Trigger"
  key_links:
    - from: "n8n credential store"
      to: "n8n workflows"
      via: "credential name references in workflow node config"
      pattern: "Supabase Service Role"
    - from: "Schedule Trigger node"
      to: "Supabase pipeline_runs table"
      via: "Supabase node insert using Supabase Service Role credential"
      pattern: "pipeline_runs"
---

<objective>
Populate the n8n credential store with all 9 API keys, and validate the Eastern Time timezone configuration by running a test workflow that writes a timestamped row to Supabase and comparing it against wall clock time.

Purpose: Credentials must be in the n8n Credential Store (encrypted, auditable, never in workflow JSON) before any workflow can authenticate to external services. The timezone canary is the only way to confirm both TZ and GENERIC_TIMEZONE are correct before production crons fire at wrong times.

Output: 9 credentials in n8n store, all passing connection tests, canary workflow JSON exported and committed.
</objective>

<execution_context>
@C:/Users/redle/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/redle/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@D:/Projects/fhcontent-creator-v2/.planning/ROADMAP.md
@D:/Projects/fhcontent-creator-v2/.planning/STATE.md
@D:/Projects/fhcontent-creator-v2/.planning/research/STACK.md
@D:/Projects/fhcontent-creator-v2/.planning/phases/01-infrastructure-foundation/01-01-SUMMARY.md
@D:/Projects/fhcontent-creator-v2/.planning/phases/01-infrastructure-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Human action — Enter all 9 credentials into n8n Credential Store</name>
  <action>
Human must enter all 9 API credentials into n8n Settings → Credentials. This cannot be automated — API key values are never stored in files or environment variables, only in the n8n Credential Store which encrypts them with N8N_ENCRYPTION_KEY.

Navigate to http://localhost:5678 and complete initial n8n setup if not done (create admin account). Then go to Settings → Credentials → Add Credential for each service below. Use EXACT credential names — these names are referenced in workflow JSON files.

Credentials to create:
1. Supabase Service Role — Type: Supabase API — Host: https://qjpujskwqaehxnqypxzu.supabase.co — Service Role Secret from project settings
2. Supabase Anon Key — Type: HTTP Header Auth — Name: Authorization — Value: Bearer [anon key]
3. Claude API — Type: HTTP Header Auth — Name: x-api-key — Value: [Anthropic key]
4. HeyGen API — Type: HTTP Header Auth — Name: X-Api-Key — Value: [HeyGen token]
5. Blotato API — Type: HTTP Header Auth — Name: api-key — Value: [Blotato key]
6. ElevenLabs API — Type: HTTP Header Auth — Name: xi-api-key — Value: [ElevenLabs key]
7. Gemini API — Type: HTTP Header Auth — Name: x-goog-api-key — Value: [Gemini key]
8. OpenAI API — Type: OpenAI API (native n8n type) — API Key: [OpenAI key]
9. Canva API — Type: HTTP Header Auth — Name: Authorization — Value: Bearer [Canva key]

After adding each credential, click "Test" or "Save & Test". Green checkmark = pass. Blotato and Canva may not support the n8n test endpoint — save them anyway and note which ones could not be tested.
  </action>
  <verify>n8n Settings → Credentials shows all 9 credentials by their exact names. At least 7 show green test status.</verify>
  <done>All 9 credentials are in n8n Settings → Credentials with exact names from README.md. Minimum 7 pass connection test (Blotato/Canva test endpoint may not exist).</done>
  <what-needed>
Navigate to http://localhost:5678 and complete initial n8n setup if not done (create admin account). Then go to Settings → Credentials → Add Credential for each of the following.

Create these 9 credentials with EXACT names (names are used in workflow JSON references):

1. **Supabase Service Role**
   - Type: Supabase API
   - Host: https://qjpujskwqaehxnqypxzu.supabase.co
   - Service Role Secret: (from Supabase dashboard → Project Settings → API → service_role)

2. **Supabase Anon Key**
   - Type: HTTP Header Auth
   - Name: Authorization
   - Value: Bearer (paste anon key here)

3. **Claude API**
   - Type: HTTP Header Auth
   - Name: x-api-key
   - Value: (Anthropic API key)

4. **HeyGen API**
   - Type: HTTP Header Auth
   - Name: X-Api-Key
   - Value: (HeyGen API token)

5. **Blotato API**
   - Type: HTTP Header Auth
   - Name: api-key (check Blotato docs for exact header name)
   - Value: (Blotato API key)

6. **ElevenLabs API**
   - Type: HTTP Header Auth
   - Name: xi-api-key
   - Value: (ElevenLabs API key)

7. **Gemini API**
   - Type: HTTP Header Auth
   - Name: x-goog-api-key
   - Value: (Gemini API key)

8. **OpenAI API**
   - Type: OpenAI API (native n8n type, NOT HTTP Header Auth)
   - API Key: (OpenAI key)

9. **Canva API**
   - Type: HTTP Header Auth
   - Name: Authorization
   - Value: Bearer (Canva API key — check Canva developer docs for correct auth header)

After adding each credential, click "Test" or "Save & Test" to confirm the connection works. A green checkmark = pass.

Note: Blotato/Canva may not support n8n's built-in test endpoint. Save them anyway and note which ones could not be auto-tested.
  </what-needed>
  <resume-signal>Type "credentials-added" and list any credentials that could NOT be tested (e.g., "credentials-added: Blotato test failed (saved anyway)")</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Build and run the canary timezone validation workflow</name>
  <files>D:/Projects/fhcontent-creator-v2/n8n-workflows/canary-timezone-test.json</files>
  <action>
This task validates that both timezone env vars (TZ and GENERIC_TIMEZONE) are correctly set by running a Schedule Trigger and comparing the n8n-reported time against the wall clock Eastern Time.

Step 1 — Create the canary workflow in n8n UI:

In n8n, create a new workflow named "Canary — Timezone Validation". Add these nodes:

Node 1: Schedule Trigger
- Interval: Every 1 minute
- Timezone: America/New_York

Node 2: Set
- Name: Build Timestamp Payload
- Set field: n8n_time → `{{ $now.toISO() }}`
- Set field: n8n_timezone → `{{ $env.GENERIC_TIMEZONE }}`
- Set field: workflow_name → "canary-timezone-test"
- Set field: status → "heartbeat"

Node 3: Supabase (using "Supabase Service Role" credential)
- Operation: Create Row
- Table: pipeline_runs
- Fields:
  - workflow_name: `{{ $json.workflow_name }}`
  - status: `{{ $json.status }}`
  - started_at: `{{ $json.n8n_time }}`
  - completed_at: `{{ $json.n8n_time }}`
  - correlation_id: `canary-{{ $now.toMillis() }}`

Note: The pipeline_runs table will be created in Phase 2. For this validation, if the table does not exist yet, substitute Node 3 with a Code node that logs to console:
```javascript
console.log('Timezone check:', $json.n8n_time, $json.n8n_timezone);
return items;
```

This is acceptable because the core validation is the Schedule Trigger firing at the correct Eastern Time — the Supabase write is secondary.

Step 2 — Activate the workflow and wait one minute for it to fire.

Step 3 — Check execution log: in n8n, click the workflow → Executions → open the latest execution.

Step 4 — Read the `n8n_time` value from the Set node output. Compare to your local wall clock time (in Eastern Time). They must match within ±2 minutes.

Step 5 — Export the workflow JSON:
In n8n UI: workflow top-right menu (...) → Export → JSON
Save to: D:/Projects/fhcontent-creator-v2/n8n-workflows/canary-timezone-test.json

Step 6 — Deactivate the workflow after validation (to prevent unnecessary Supabase writes before pipeline_runs table exists):
Toggle workflow Active switch to OFF.

Step 7 — Commit the exported JSON to git:
```bash
cd D:/Projects/fhcontent-creator-v2
git add n8n-workflows/canary-timezone-test.json n8n-workflows/README.md
git commit -m "feat(01-infrastructure): add n8n workflow scaffolding and canary timezone test"
```
  </action>
  <verify>
1. n8n execution log shows the canary workflow fired at least once
2. The `n8n_time` in the execution output matches the current Eastern Time wall clock (±2 minutes)
3. The `n8n_timezone` field in execution output shows "America/New_York"
4. `docker exec n8n_app env | grep -E "TZ|GENERIC_TIMEZONE"` — both show America/New_York
5. `ls D:/Projects/fhcontent-creator-v2/n8n-workflows/canary-timezone-test.json` — file exists
  </verify>
  <done>Canary workflow fired, n8n_time matches Eastern Time wall clock, both timezone vars confirmed as America/New_York, workflow JSON exported and committed.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Final Phase 1 verification — all 9 credentials and timezone confirmed</name>
  <action>
Human verifies that all Phase 1 infrastructure components are in place and working correctly. This checkpoint confirms the phase is complete before Phase 2 (Error Infrastructure) begins.

Check 1 — n8n Settings → Credentials: all 9 credentials visible by exact name.
Check 2 — Test each credential connection.
Check 3 — Canary execution log: n8n_time matches Eastern Time wall clock.
Check 4 — `docker exec n8n_app n8n --version` returns 2.9.0.
Check 5 — Canary JSON committed to git.
  </action>
  <verify>
1. n8n Settings → Credentials shows all 9 by exact name
2. At least 7 credentials show green test status
3. Canary execution log n8n_time matches Eastern Time (±2 min)
4. n8n version is 2.9.0
5. git log shows canary JSON committed
  </verify>
  <done>All 9 credentials in store, timezone validated, n8n version confirmed, canary JSON committed. Phase 1 complete.</done>
  <what-built>
All 9 API credentials entered in n8n Settings → Credentials with exact names. Canary workflow confirmed Schedule Trigger fires at correct Eastern Time. All Phase 1 infrastructure components are in place.
  </what-built>
  <how-to-verify>
1. Open n8n at http://localhost:5678 → Settings → Credentials
   - EXPECTED: All 9 credentials visible by exact name (Supabase Service Role, Supabase Anon Key, Claude API, HeyGen API, Blotato API, ElevenLabs API, Gemini API, OpenAI API, Canva API)
   - FAIL: Any credential missing or named differently

2. Click each credential → Test connection
   - EXPECTED: Green checkmark or "Credential is working" for the 7 auto-testable ones
   - ACCEPTABLE FAIL: Blotato and/or Canva show test error if their test endpoint is not supported — note which ones

3. Check canary execution log:
   - Open the "Canary — Timezone Validation" workflow
   - Click Executions → latest execution
   - EXPECTED: n8n_time field shows time matching your current Eastern Time clock (±2 min)
   - FAIL: Time is UTC (5 hours off) or wrong timezone

4. Verify n8n version one more time:
   - Run in terminal: `docker exec n8n_app n8n --version`
   - EXPECTED: 2.9.0
   - FAIL: Any version below 1.121.0

5. Confirm the n8n-workflows/canary-timezone-test.json is in git:
   - Run: `git log --oneline D:/Projects/fhcontent-creator-v2/n8n-workflows/`
   - EXPECTED: Commit for "feat(01-infrastructure): add n8n workflow scaffolding..."
  </how-to-verify>
  <resume-signal>Type "phase1-complete" if all checks pass. If any credential test failed, type "phase1-complete: [credential names that failed test]" so the issue is noted for Phase 3 troubleshooting.</resume-signal>
</task>

</tasks>

<verification>
Phase 1 full completion check:
1. `docker exec n8n_app n8n --version` → 2.9.0
2. `curl -s http://localhost:5678/healthz` → {"status":"ok"}
3. `docker exec n8n_app env | grep -E "TZ|GENERIC_TIMEZONE|WEBHOOK_URL|EXECUTIONS_DATA_PRUNE"` → all 4 vars correct
4. n8n UI → Settings → Credentials → 9 credentials listed
5. n8n Canary execution log → n8n_time matches Eastern Time
6. `Get-Service "n8n-docker"` (PowerShell) → Running
7. `powercfg /getactivescheme` → High Performance
8. `git log --oneline n8n-workflows/` → canary JSON committed
</verification>

<success_criteria>
- All 9 credentials (Claude, HeyGen, Blotato, ElevenLabs, Gemini, OpenAI, Canva, Supabase service key, Supabase anon key) are in n8n Settings → Credentials with exact names from README.md
- At minimum 7 of 9 credentials pass the n8n connection test (Blotato and Canva may not have test endpoints)
- Canary Schedule Trigger fired and written timestamp matches Eastern Time wall clock (±2 minutes)
- Both TZ and GENERIC_TIMEZONE confirmed as America/New_York in container environment
- Canary workflow JSON exported and committed to n8n-workflows/
- n8n version confirmed as 2.9.0 (above CVE-2026-21858 threshold)
</success_criteria>

<output>
After completion, create `D:/Projects/fhcontent-creator-v2/.planning/phases/01-infrastructure-foundation/01-04-SUMMARY.md` following the summary template. Record which credentials were successfully tested and any that required manual verification — this informs Phase 3 (HMAC security) debugging if connection issues emerge.
</output>
